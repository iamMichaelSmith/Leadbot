<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Lead Dashboard</title>
    <link rel="stylesheet" href="/static/app.css" />
    <script defer src="/static/app.js"></script>
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <h1>Lead Dashboard</h1>
        <div class="meta">Rotate after {{ rotate_days }} days &middot; Page limit {{ page_limit }}</div>
      </div>
      <div class="user">
        <a class="saved-replies" href="https://docs.google.com/document/d/1B2_b9mMoEsmBcko-h8k0k5d7mJZ0CX94iApiUP9lf4o/edit?usp=sharing" target="_blank" rel="noreferrer">(Saved replies)</a>
        <span>Signed in as {{ user }}</span>
        <a class="logout" href="/logout">Logout</a>
      </div>
    </header>

    <section class="filters">
      <div class="count">Leads: {{ leads | length }}</div>
    </section>

    <main class="cards">
      {% for lead in leads %}
      <article class="card" data-lead-id="{{ lead.lead_id }}">
        <div class="card-header">
          <div>
            <div class="company">{{ lead.company_name or "unknown" }}</div>
            <div class="site">
              <a href="{{ lead.source_url }}" target="_blank" rel="noreferrer">Open site</a>
              {% if lead.contact_url %}
              &middot; <a href="{{ lead.contact_url }}" target="_blank" rel="noreferrer">Contact page</a>
              {% endif %}
            </div>
          </div>
          <div class="badges">
            <span class="badge">Role: {{ lead.role or "unknown" }}</span>
            <span class="badge">Role conf: {{ lead.role_confidence or 0 }}</span>
            <span class="badge">Library conf: {{ lead.library_confidence or 0 }}</span>
          </div>
        </div>

        <div class="details">
          <div>
            <strong>Email:</strong>
            {% if lead.email %}
            <a href="mailto:{{ lead.email }}">{{ lead.email }}</a>
            {% else %}
            &mdash;
            {% endif %}
          </div>
          <div>
            <strong>Contact:</strong>
            {% if lead.contact_url %}
            <a href="{{ lead.contact_url }}" target="_blank" rel="noreferrer">{{ lead.contact_url }}</a>
            {% else %}
            &mdash;
            {% endif %}
          </div>
          <div>
            <strong>Source:</strong>
            {% if lead.source_url %}
            <a href="{{ lead.source_url }}" target="_blank" rel="noreferrer">{{ lead.source_url }}</a>
            {% else %}
            &mdash;
            {% endif %}
          </div>
          <div><strong>Last seen:</strong> {{ lead.last_seen or "-" }}</div>
        </div>

        <div class="row">
          <form class="field status-form" method="post" action="/lead/{{ lead.lead_id }}/status">
            <label>Status</label>
            <div class="inline">
              <button class="thumb up" type="submit" name="status" value="contacted">Reached out</button>
              <button class="thumb down" type="submit" name="status" value="skipped">Skip</button>
            </div>

          <label>Notes</label>
          <textarea name="notes" rows="2" data-lead-id="{{ lead.lead_id }}">{{ lead.notes or "" }}</textarea>
          </form>
        </div>

      </article>
      {% endfor %}
    </main>
  </body>
</html>
